<script>
if(localStorage.getItem('pod')){
	p=localStorage.getItem('pod');
	newWin(p);
}
else{
	p = prompt("What is your Diaspora host?");
	localStorage.setItem("pod",p);
	newWin();
}
function newWin(){
	chrome.tabs.getSelected(null,
		function(tab){
			var pod = "https://"+p+"/bookmarklet",
				url = "?url="+encodeURIComponent(tab.url),
				title = "&title="+encodeURIComponent(tab.title),
				notes = "&notes="+encodeURIComponent(""),
				version = "&v=1",
				noui = "&noui=1",
				jump = "&jump=doclose",
				name = "diasporav1",
				features = 'location=yes,links=no,scrollbars=no,toolbar=no,width=620,height=250'
			a=function(){window.open(pod+url+title+notes+version+noui+jump, name, features)}
			setTimeout(a,0);
		});
	}
</script>